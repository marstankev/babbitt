<html>
    <head>
        <!-- <script src="https://unpkg.com/unmute" data-add-button="true"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.1/Tone.js"></script>
        <script src="./index.js"></script>

        <script>
            function handleNewSequence() {
                Tone.Transport.stop()
                Tone.Transport.cancel()

                const sequence = buildSequence()
                const sequenceString = sequence.join(' ')
                const sequenceHTML = sequence.reduce((acc, note) => {
                    return `${acc} <span id=${note} class='note'> ${note} </span>`
                }, '')
                const sequenceElem = document.querySelector('#sequence')
                sequenceElem.innerHTML = sequenceHTML

                const synth = new Tone.Synth().toDestination()
                const synthPart = new Tone.Sequence(
                    function(time, note) {
                        if (time && note) {
                            // const noteWithOctave = note + randomIntFromRange(2, 4)
                            if (time) synth.triggerAttackRelease(note + 3, "1000hz", time)
                            
                            const allNotes = document.getElementsByClassName('note')
                            Array.from(allNotes).map(noteElem => noteElem.style.color = 'black')
                            const currNote = document.getElementById(note)
                            currNote.style.color = 'red'
                        }
                    },
                    sequence,
                    "8n"
                )

                synthPart.start()
                Tone.Transport.start()
            }

            function handlePause() {
                Tone.Transport.pause()
            }

            function handleResume() {
                Tone.Transport.start()
            }
        </script>
    </head>
    <body>
        <img src="./trichordal-array.png" alt="trichordal array">
        <br>
        <button onclick={handleNewSequence()}>new sequence</button>
        <button onclick={handlePause()}>pause</button>
        <button onclick={handleResume()}>resume</button>

        <h1 id='sequence'></h1>
        <h1 id='note'></h1>
    </body>
</html>
